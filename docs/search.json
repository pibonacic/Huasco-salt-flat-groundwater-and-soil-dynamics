[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Exploración de las relaciones entre aguas subterráneas y variables del suelo",
    "section": "",
    "text": "Los humedales altoandinos son piezas clave de los balances de agua, energía y carbono en la región del Altiplano, procesos que dependen de la disponibilidad de aguas subterráneas cercanas a la superficie. Pese a su relevancia, estos ecosistemas enfrentan amenazas crecientes debido al cambio climático y la actividad minera. Además, los métodos de monitoreo hidrogeológico actuales son caros y difíciles de implementar en estos ambientes remotos.\nEl objetivo de este trabajo es explorar las relaciones entre profundidad del agua subterránea y variables medidas en el suelo para evaluar el desarrollo de metodologías de monitoreo alternativas, usando el Salar del Huasco como caso de estudio.\n\n\n\nFigura 1. Localización del Salar del Huasco y sus estaciones de monitoreo\n\n\nEn la actualidad, se cuenta con dos estaciones de monitoreo en el sitio: norte y sur. En este trabajo se emplearán los datos recolectados en la estación norte, donde se cuenta con un piezómetro y tres sensores de suelo ubicados a diferentes profundidades (15, 30 y 48 cm). El piezómetro reporta la profundidad del nivel freático (m), mientras que los sensores de suelo, datos de contenido de agua (m³/m³)y temperatura (°C)."
  },
  {
    "objectID": "index.html#introduccióncontexto",
    "href": "index.html#introduccióncontexto",
    "title": "Estructura de proyecto final",
    "section": "",
    "text": "Dos alternativas (no excluyentes): - Establecimiento de la relevancia de la investigación - Contextualización del área de estudio y de los sensores usados\n\n\n\nLocalización del área de estudio"
  },
  {
    "objectID": "index.html#resultadosanálisis-exploratorio",
    "href": "index.html#resultadosanálisis-exploratorio",
    "title": "Estructura de proyecto final",
    "section": "Resultados/análisis exploratorio",
    "text": "Resultados/análisis exploratorio\nIntercalar secuencias de texto introductorio y explicativo con gráficas clave.\n\nPreprocesamiento\nLectura y formateo de datos\n\n\nCode\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\n\n# Cargar Datos\npiezo_df = pd.read_csv(\n    '../data/processed/03_daily/piezo-data_SDH1PS01_daily.csv', \n    parse_dates=['Timestamps'], index_col='Timestamps',\n    usecols=['Timestamps', 'depth_m']\n)\n\nsoil_df = pd.read_csv(\n    '../data/processed/03_daily/soil-data_z6-25818_daily.csv', \n    parse_dates=['Timestamps'], index_col='Timestamps',\n    usecols=['Timestamps',\n             'TEROS12_15cm_water-content_m3/m3', 'TEROS12_30cm_water-content_m3/m3', 'TEROS12_48cm_water-content_m3/m3',\n             'TEROS12_15cm_soil-temperature_degree_C', 'TEROS12_30cm_soil-temperature_degree_C', 'TEROS12_48cm_soil-temperature_degree_C']\n)\n\n# Diccionarios de mapeo para nombres más limpios y extracción de metadatos\n# Formato: Sensor_Profundidad_Variable\nsoil_rename_map = {\n    'TEROS12_15cm_water-content_m3/m3': 'Suelo_15cm_Contenido-agua',\n    'TEROS12_30cm_water-content_m3/m3': 'Suelo_30cm_Contenido-agua',\n    'TEROS12_48cm_water-content_m3/m3': 'Suelo_48cm_Contenido-agua',\n    'TEROS12_15cm_soil-temperature_degree_C': 'Suelo_15cm_Temperatura',\n    'TEROS12_30cm_soil-temperature_degree_C': 'Suelo_30cm_Temperatura',\n    'TEROS12_48cm_soil-temperature_degree_C': 'Suelo_48cm_Temperatura'\n}\n\n# Renombrar columnas\nsoil_df = soil_df.rename(columns=soil_rename_map)\npiezo_df = piezo_df.rename(columns={'depth_m': 'Piezometro_NA_Profundidad-nivel-freatico'})\n\n# Unir datasets\ndf_merged = pd.merge(piezo_df, soil_df, left_index=True, right_index=True, how='inner')\n\n# Transformar a formato largo\ndf_long = df_merged.reset_index().melt(id_vars='Timestamps', var_name='metadata', value_name='Valor')\n\n# Extraer metadatos dividiendo el string por guiones bajos (estructura: Sensor_Profundidad_Variable)\nmetadata_split = df_long['metadata'].str.split('_', expand=True)\ndf_long['Sensor'] = metadata_split[0]           # Ej: Suelo, Piezometro\ndf_long['Profundidad'] = metadata_split[1]  # Ej: 15cm, 30cm, NA\ndf_long['Variable'] = metadata_split[2]         # Ej: Contenido-agua, Temperatura\n\n# Generacion de un espacio entre el numero y la unidad para etiquetas\ndf_long['Profundidad_label'] = df_long['Profundidad'].str.replace('cm', ' cm').replace('NA', 'NA')\n\n# Definir etiquetas limpias para los gráficos\nvariable_labels = {\n    'Profundidad-nivel-freatico': 'Prof. del nivel freático (m)',\n    'Contenido-agua': 'Contenido de agua (m³/m³)',\n    'Temperatura': 'Temperatura (°C)'\n}\n# Mapeamos para usar en el facet grid\ndf_long['Variable_label'] = df_long['Variable'].map(variable_labels)\n\n# Orden específico para las profundidades en la leyenda\nsoil_depth_order = ['15 cm', '30 cm', '48 cm']\nfull_depth_order = ['15 cm', '30 cm', '48 cm', 'NA']\n\n\n\n\nVisualización preliminar\n\n\nCode\n# Configuración de estilo\nsns.set_theme(style=\"ticks\", context=\"notebook\", font_scale=1)\nplt.rcParams['axes.grid'] = True\nplt.rcParams['grid.alpha'] = 0.3\nplt.rcParams['figure.figsize'] = (12, 8)\n\n# Configuracion de paleta de colores\nviridis_colors = sns.color_palette(\"viridis_r\", n_colors=3)\npalette_dict = {\n    '15 cm': viridis_colors[0], # Más claro (verde claro)\n    '30 cm': viridis_colors[1], # Medio (verde azulado)\n    '48 cm': viridis_colors[2], # Más oscuro (morado)\n    'NA': 'black'               # Negro\n}\n\n# Generar la figura base usando relplot\ng = sns.relplot(\n    data=df_long,\n    x='Timestamps',\n    y='Valor',\n    row='Variable_label',      # Crea una fila por cada variable\n    hue='Profundidad_label',   # Diferencia colores según profundidad\n    kind='line',\n    palette=palette_dict,      # Uso de diccionario de colores personalizado\n    hue_order=full_depth_order,\n    height=3,\n    aspect=3.5,\n    facet_kws={'sharey': False, 'sharex': True} # Eje X compartido, Eje Y independiente\n)\n\n# Personalización de ejes y paneles\ng.set_titles(\"\")  # Eliminar los títulos sobre cada panel\ng.set_xlabels(\"\") # Eliminar la etiqueta del eje X\n\n# Iterar sobre cada panel (subplot) para aplicar estilos específicos\nfor i, (ax, title) in enumerate(zip(g.axes.flat, g.row_names)):\n    # Etiqueta del eje Y: Texto normal y alineado\n    ax.set_ylabel(title, fontweight='normal')\n    \n    # Configuración específica para el primer panel (Nivel Freático)\n    if 'Prof. del nivel freático (m)' in title:\n        ax.invert_yaxis() # Invertir eje\n        \n        # Dibujar líneas de referencia horizontales para la ubicación de sensores\n        sensor_depths_m = [0.15, 0.30, 0.48]\n        sensor_labels = ['15 cm', '30 cm', '48 cm']\n        \n        for d_m, lbl in zip(sensor_depths_m, sensor_labels):\n            # Línea punteada del color correspondiente al sensor\n            ax.axhline(y=d_m, color=palette_dict[lbl], linestyle='--', linewidth=1, alpha=0.8)\n\n    # Formato de fecha en el eje X\n    date_fmt = mdates.DateFormatter('%d %b %Y')\n    ax.xaxis.set_major_formatter(date_fmt)\n\n\n# Personalización de la leyenda\n# Extraer los objetos (handles) y etiquetas actuales del primer gráfico\nhandles, labels = g.axes[0,0].get_legend_handles_labels()\n\n# Filtrar la lista para excluir 'NA' (Nivel freático), ya que es la línea negra\nclean_handles = [h for h, l in zip(handles, labels) if l != 'NA']\nclean_labels = [l for l in labels if l != 'NA']\n\n# Eliminar la leyenda por defecto a la derecha\ng._legend.remove()\n\n# Crear una nueva leyenda personalizada\ng.fig.legend(\n    clean_handles, \n    clean_labels, \n    loc='lower center', \n    bbox_to_anchor=(0.5, 0),\n    ncol=3, # Disposición horizontal\n    title=\"Profundidad de los sensores de suelo\",\n    frameon=False\n)\n\n# Ajustes finales\n# Título principal de la figura\ng.fig.suptitle(\"Evolución de variables piezométricas y edáficas\", x=0.5, y=0.98, fontsize=14)\n# Ajustes de espaciado\nplt.tight_layout()\nplt.subplots_adjust(top=0.93, bottom=0.11) # Ajusta espacio disponible para subplots\n\nplt.show()\n\n\n\n\n\nSeries temporales\n\n\n\n\n\n\nCode\n# Preparación de datos para scatter plot\n# Filtrar los datos de suelo\ndf_soil = df_long[df_long['Sensor'] == 'Suelo'].copy()\n\n# Extraer la serie de nivel freático (NA) y convertir en una columna\npiezo_col = df_long[df_long['Profundidad_label'] == 'NA'].set_index('Timestamps')['Valor']\n\n# Unir por fecha\ndf_scatter = df_soil.merge(piezo_col.rename('GWD'), left_on='Timestamps', right_index=True)\n\n# Generar la figura base usando relplot scatter\ng2 = sns.relplot(\n    data=df_scatter,\n    x='Valor',                  # Eje X: Variables de suelo\n    y='GWD',                    # Eje Y: Nivel freático\n    row='Profundidad_label',    # Filas: Profundidad (15, 30, 48)\n    col='Variable_label',       # Columnas: Variable (Contenido-agua, Temperatura)\n    hue='Profundidad_label',\n    kind='scatter',\n    palette=palette_dict,\n    row_order=soil_depth_order, # 15, 30, 48\n    hue_order=soil_depth_order,\n    height=3,\n    aspect=1.2,\n    facet_kws={'sharey': True, 'sharex': 'col'}, \n    alpha=0.7,\n    s=30\n)\n\n# Personalización de ejes y paneles\n# Eliminar los títulos automáticos de los subplots\ng2.set_titles(\"\") \n\n# Inversión del eje Y\n# Calcular min y max de los datos para establecer los límites manualmente\ny_min = df_scatter['GWD'].min()\ny_max = df_scatter['GWD'].max()\npadding = (y_max - y_min) * 0.05 # Agregar un 5% de espacio\ng2.set(ylim=(y_max + padding, y_min - padding))\n\n# Configurar etiquetas del eje X en la fila inferior\ng2.set_xlabels(\"\") # Limpiar etiquetas automáticas\ng2.axes[-1, 0].set_xlabel(\"Contenido de agua (m³/m³)\")\ng2.axes[-1, 1].set_xlabel(\"Temperatura (°C)\")\n\n# Etiqueta Global del Eje Y\ng2.set_ylabels(\"\") # Borrar etiquetas individuales automáticas\ng2.fig.supylabel(\n    \"Profundidad del nivel freático (m)\", \n    x=0.04, \n    size=plt.rcParams['axes.labelsize'], # Igualar tamaño al eje X\n)\n\n# Personalización de la leyenda\n# Extraer handles/labels del primer panel\nhandles, labels = g2.axes[0,0].get_legend_handles_labels()\n\n# Eliminar la leyenda automática\ng2._legend.remove()\n\n# Crear leyenda personalizada\ng2.fig.legend(\n    handles=handles,\n    labels=labels,\n    loc='lower center',\n    bbox_to_anchor=(0.5, 0), \n    ncol=3,\n    title=\"Profundidad de los sensores de suelo\",\n    frameon=False\n)\n\n# Ajustes finales\n# Título principal\ng2.fig.suptitle(\"Relación entre variables de suelo y profundidad del nivel freático\", y=0.98, fontsize=14)\n\n# Ajustes de espaciado\nplt.tight_layout()\nplt.subplots_adjust(top=0.94, bottom=0.13, left=0.11) # Ajusta espacio disponible para subplots\n\nplt.show()\n\n\n\n\n\nScatter plots\n\n\n\n\n\n\nCorrelaciones cruzadas\n\nTabla con resultados de tests para evaluar estacionariedad de los datos (ADF, KPSS) antes y después del detrending.\nGráficas de series temporales sin tendencia: similar a gráfica 1.\nGráficas de coeficientes de correlación anuales: dos facet (uno por variable: contenido de agua y temperatura), cada uno de tres filas (una por profundidad). Los gráficos comparten el eje X (número de lags).\nGráficas de coeficientes de correlación para una temporada específica (dependiente de la visualización preliminar)."
  },
  {
    "objectID": "index.html#conclusionesdesafíos",
    "href": "index.html#conclusionesdesafíos",
    "title": "Estructura de proyecto final",
    "section": "Conclusiones/desafíos",
    "text": "Conclusiones/desafíos\nDesarrollar una conclusión a partir de los resultados iniciales y cuáles serían próximos pasos a desarrollar para continuar con la investigación:\n\nExploración de correlaciones en diferentes momentos temporales\nExploración de correlaciones con datos de otros sitios\nExploración de correlaciones con otro tipo de datos (meteorológicos, flujos de calor)"
  },
  {
    "objectID": "index.html#contexto",
    "href": "index.html#contexto",
    "title": "Exploración de las relaciones entre aguas subterráneas y variables del suelo",
    "section": "",
    "text": "Los humedales altoandinos son piezas clave de los balances de agua, energía y carbono en la región del Altiplano, procesos que dependen de la disponibilidad de aguas subterráneas cercanas a la superficie. Pese a su relevancia, estos ecosistemas enfrentan amenazas crecientes debido al cambio climático y la actividad minera. Además, los métodos de monitoreo hidrogeológico actuales son caros y difíciles de implementar en estos ambientes remotos.\nEl objetivo de este trabajo es explorar las relaciones entre profundidad del agua subterránea y variables medidas en el suelo para evaluar el desarrollo de metodologías de monitoreo alternativas, usando el Salar del Huasco como caso de estudio.\n\n\n\nFigura 1. Localización del Salar del Huasco y sus estaciones de monitoreo\n\n\nEn la actualidad, se cuenta con dos estaciones de monitoreo en el sitio: norte y sur. En este trabajo se emplearán los datos recolectados en la estación norte, donde se cuenta con un piezómetro y tres sensores de suelo ubicados a diferentes profundidades (15, 30 y 48 cm). El piezómetro reporta la profundidad del nivel freático (m), mientras que los sensores de suelo, datos de contenido de agua (m³/m³)y temperatura (°C)."
  },
  {
    "objectID": "index.html#análisis-exploratorio",
    "href": "index.html#análisis-exploratorio",
    "title": "Exploración de las relaciones entre aguas subterráneas y variables del suelo",
    "section": "Análisis exploratorio",
    "text": "Análisis exploratorio\nLos datos crudos entregados por los instrumentos fueron preprocesados previo a este análisis. Los scripts correspondientes están disponibles aquí y el d. Los datos crudos y procesados están disponibles aquí. El código completo asociado a las visualizaciones presentadas está disponible en este notebook.\n\nSeries temporales\nEn primer lugar, se graficaron las series de tiempo de profundidad del nivel freático, así como de contenido de agua y temperatura del suelo a las tres profundidades disponibles (Figura 2). Cabe mencionar que el eje Y del primer panel está invertido para facilitar la interpretación de la profundidad de las aguas subterráneas.\nSe observa que la profundidad del nivel freático es variable en el tiempo, alcanzando máximos en primavera y mínimos en invierno. Aparentemente, el contenido de agua en el suelo a 15 y 30 cm sigue un patrón similar al de las aguas subterráneas, puesto que comparten momentos de ascenso y descenso. El contenido de agua a 48 cm no muestra mayor variabilidad durante el año. Por otro lado, la temperatura del suelo tiene un marcado ciclo estacional, con valores máximos en verano y mínimos en invierno, por lo que, no se ve relacionada con la profundidad del nivel freático a primera vista.\n\n\nCode\n# Creacion de la figura base\ntime_series = sns.relplot(\n    data=long_df,\n    x='Timestamps',\n    y='Value',\n    hue ='Depth-label',             # Diferencia colores segun profundidad\n    row='Variable-label',           # Una fila por cada variable\n    palette=palette_dict,\n    hue_order=full_depth_order,\n    kind='line',                    # Grafico de lineas\n    height=3,\n    aspect=2.5,\n    facet_kws={'sharey': False, 'sharex':True}      # Eje Y independiente, eje X compartido\n)\n\n# Eliminacion de elementos incluidos por defecto\ntime_series.set_titles('')\ntime_series.set_xlabels('')\ntime_series._legend.remove()\n\n# Iteracion sobre facets para aplicar estilos particulares\nfor i, (ax, title) in enumerate(zip(time_series.axes.flat, time_series.row_names)):\n\n    # Etiquetado de los ejes Y de cada facet\n    ax.set_ylabel(title, fontweight='normal')\n\n    # Formateo de fechas en el eje X\n    date_format = mdates.DateFormatter('%b %Y')\n    ax.xaxis.set_major_formatter(date_format)\n\n    # Configuracion particular para el primer facet\n    if 'Prof. nivel freático (m)' in title:\n        \n        # Invierte el eje Y\n        ax.invert_yaxis()\n\n        # Traza profundidad de sensores de suelo como lineas horizontales\n        sensor_depths_m = [0.15, 0.30, 0.48]\n        for depth, label in zip(sensor_depths_m, soil_depth_order):\n            ax.axhline(y=depth, color=palette_dict[label], linestyle='--', linewidth= 0.9, alpha=0.8)\n\n# Eliminacion de la leyenda de objetos asociados al piezometro\nhandles, labels = time_series.axes[0,0].get_legend_handles_labels()\nclean_handles = [h for h, l in zip(handles, labels) if l != 'NA']\nclean_labels = [l for l in labels if l != 'NA']\n\n# Creacion de nueva leyenda\ntime_series.figure.legend(\n    handles=clean_handles,\n    labels=clean_labels,\n    loc='lower center',\n    bbox_to_anchor=(0.5, 0),\n    ncol=3,\n    title=\"Profundidad de los sensores de suelo\",\n    frameon=False\n)\n\n# Establecimiento de titulo\n# time_series.figure.suptitle(\"Evolución de variables piezométricas y edáficas\",\n#                             x=0.5, y=0.98, fontsize=14)\n\n# Ajustes de espaciado\nplt.tight_layout()\nplt.subplots_adjust(top=0.93, bottom=0.11) # Ajusta espacio disponible para facets\n\nplt.show()\n\n\n\n\n\nFigura 2. Series temporales de profundidad del nivel freático, contenido de agua y temperatura del suelo.\n\n\n\n\n\n\nCorrelaciones cruzadas\nPara evaluar la existencia de posibles desfases temporales entre las series de datos, se ejecutó un análisis de correlaciones cruzadas. En él, se calculó la correlación de Pearson entre la serie de profundidad del nivel freático y las series de contenido de agua y temperatura del suelo, desplazadas temporalmente hasta ±15 días (Figura 3). Se definió esta temporalidad porque no son esperables relaciones significativas en periodos mayores. Previo al análisis, las series fueron procesadas para alcanzar la estacionariedad.\nPara la variable de contenido de agua, se observa que la mayor correlación con el nivel freático se da en el desfase cero, y es negativa para los tres sensores. Esto indica que un aumento del contenido de agua se acompaña de una disminución de la profundidad de las aguas subterráneas, y viceversa. La relación más fuerte se da en el sensor a 30 cm. Respecto a la temperatura del suelo, se constatan relaciones inversas en el desfase -1 en los sensores a 30 y 48 cm, lo que significa que un aumento en la temperatura suele anteceder en un día un aumento en la profundidad del nivel freático en los sensores más profundos.\n\n\nCode\n# Creacion de la figura base\ncross_corr = sns.relplot(\n    data=cross_corr_df,\n    x='Lag',\n    y='Cross-correlation',\n    hue='Depth-label',\n    row='Variable-label',\n    palette=palette_dict,\n    kind='line',\n    height=3,\n    aspect=2.5\n)\n\n# Eliminacion de elementos incluidos por defecto\ncross_corr.set_titles('')\ncross_corr.set_xlabels('')\ncross_corr._legend.remove()\n\n# Iteracion sobre facets para etiquetar los ejes Y\nfor ax, title in zip(cross_corr.axes.flat, cross_corr.row_names):\n    ax.set_ylabel(title)\n\n# Etiquetado del eje X\nax.set_xlabel('Días de desfase')\n# Trazado de lineas de referencia\nfor ax in cross_corr.axes.flat:\n\n    # Trazado de lineas 0, 0\n    ax.axvline(0, color='gray', linestyle='--', linewidth=0.8, alpha=0.6)\n    ax.axhline(0, color='black', linestyle='-', linewidth=1, alpha=0.7)\n\n    # Trazado de limites de confianza\n    ax.axhline(conf_cross_corr, color='gray', linestyle='--', linewidth=0.8, alpha=0.5)\n    ax.axhline(-conf_cross_corr, color='gray', linestyle='--', linewidth=0.8, alpha=0.5)\n    ax.axhspan(-conf_cross_corr, conf_cross_corr, color='gray', alpha=0.05)\n\n    # Anotacion del limite de confianza\n    ax.text(\n        x=0.82,\n        y=0.87,\n        s='Intervalo de confianza al 95%',\n        transform=ax.transAxes,\n        fontsize=8,\n        color='gray'\n    )  \n\n# Creacion de nueva leyenda\ncross_corr.figure.legend(\n    loc='lower center',\n    bbox_to_anchor=(0.53, -0.07),\n    ncol=3,\n    title=\"Profundidad de los sensores de suelo\",\n    frameon=False\n)\n\n# Establecimiento de titulo\n# cross_corr.figure.suptitle(\"Correlaciones cruzadas entre nivel freático y variables del suelo\", \n#                            x=0.5, y=0.98, fontsize=14)\n\n# Ajustes de espaciado\nplt.tight_layout()\nplt.subplots_adjust(top=0.93, bottom=0.11) # Ajusta espacio disponible para facets\n\nplt.show()\n\n\n\n\n\nFigura 3. Correlaciones entre series de profundidad del nivel freático y variables del suelo, desfasadas temporalmente.\n\n\n\n\n\n\nGráficos de dispersión\nA fin de identificar las relaciones entre nivel freático y variables del suelo, se generaron gráficos de dispersión a distintas profundidades con datos diferenciados por mes, para visualizar su evolución temporal (Figura 4). Notar que los ejes Y están invertidos en todos los gráficos.\nEn términos generales, en los sensores a 15 y 30 cm se observa una relación inversa entre la profundidad del nivel freático y el contenido de agua del suelo, que es aparentemente no lineal. Por otra parte, en el sensor a 48 cm no existe una variación importante del contenido de agua, independientemente de la profundidad del nivel. Del mismo modo, la profundidad del agua subterránea parece ser independiente de la temperatura, siendo las variaciones atribuibles a los cambios de estación.\n\n\nCode\n# Creacion de la figura base\nscatter_plot = sns.relplot(\n    data=scatter_df,\n    x='Value',                          # Eje X: variables de suelo\n    y='Groundwater-depth-m',            # Eje Y: profundidad nivel freatico\n    hue='Month',                        # Coloreado por mes\n    row='Depth-label',                  # Una fila por profundidad\n    col='Variable-label',               # Una columna por variable\n    row_order=soil_depth_order,\n    palette='twilight_shifted',         # Paleta ciclica\n    kind='scatter',\n    height=3,\n    aspect=1,\n    facet_kws={'sharey': True, 'sharex': 'col'},    # Eje Y compartido, Eje X: compartido por columnas\n    s=50,\n    alpha=0.9,\n    legend='full'\n)\n\n# Eliminacion de elementos incluidos por defecto\nscatter_plot.set_titles('')\nscatter_plot.set_xlabels('')\nscatter_plot.set_ylabels('')\n\n# Etiquetado del eje X\nscatter_plot.axes[-1, 0].set_xlabel(\"Contenido de agua (m³/m³)\")\nscatter_plot.axes[-1, 1].set_xlabel(\"Temperatura (°C)\")\n\n# Inversion del eje Y (+ margen)\ny_min, y_max = scatter_df['Groundwater-depth-m'].min(), scatter_df['Groundwater-depth-m'].max()\npadding = (y_max - y_min) * 0.05\nscatter_plot.set(ylim=(y_max + padding, y_min - padding))\n\n# Etiquetado del eje Y\nscatter_plot.figure.supylabel(\n    'Profundidad del nivel freático (m)',\n    x=0.04,\n    size=plt.rcParams['axes.labelsize'], # Igualar tamaño al eje X\n    )\n\n# Titulo de leyenda\nlegend = scatter_plot._legend\nlegend.set_title('Mes')\n\n# Etiquetado de meses en leyenda\nmonth_names = {str(i): calendar.month_abbr[i] for i in range(1, 13)}\nfor t in legend.texts:\n    if t.get_text() in month_names:\n        t.set_text(month_names[t.get_text()])\n\n# Iteracion sobre los facets para agregar etiqueta de profundidad\nfor ax, label in zip(scatter_plot.axes[:, -1], soil_depth_order):\n    ax.text(\n        x=0.95,\n        y=0.95,\n        s=f'{label}',\n        transform=ax.transAxes,\n        ha='right',\n        va='top',\n        fontsize=10,\n    )\n\n# Establecimiento de titulo\n# scatter_plot.figure.suptitle(\"Relación entre variables de suelo y profundidad del nivel freático\",\n#                              x=0.5, y=0.98, fontsize=14)\n\n# Ajustes de espaciado\nplt.tight_layout()\nplt.subplots_adjust(top=0.94, right=0.85) # Ajusta espacio disponible para facets\n\nplt.show()\n\n\n\n\n\nFigura 4. Relaciones entre profundidad del nivel freático y variables del suelo diferenciadas mensualmente. Eje Y invertido\n\n\n\n\n\n\nCorrelaciones móviles\nCon el objetivo de visualizar la evolución de las correlaciones entre variables en diferentes estaciones del año, se hizo un análisis de correlación empleando ventanas móviles de 61 días. En él, se calculó la correlación de Pearson entre las series estacionarias para cada día disponible usando las observaciones de ±30 días, además del día presente (Figura 5). Se definió una ventana de dos meses para contar con un número de observaciones suficiente para el análisis estadístico, además de suavizar los resultados obtenidos y facilitar la interpretación.\nLas relaciones más fuertes entre contenido de agua y profundidad del nivel freatico se dan durante el verano y son inversas, siendo las mayores a la profundidad de 30 cm. Durante la primavera se da una relación significativa directa en los sensores a 15 y 30 cm, lo que indica que un aumento del contenido de agua se acompaña de un aumento de la profundidad del nivel. En la variable temperatura se da un patrón opuesto: en primavera se dan relaciones inversas, mientras que en verano son directas.\n\n\nCode\n# Creacion de la figura base\nroll_corr = sns.relplot(\n    data=rolling_corr_df,\n    x='Timestamps',\n    y='Rolling-correlation',\n    hue='Depth-label',\n    row='Variable-label',\n    palette=palette_dict,\n    kind='line',\n    height=3,\n    aspect=2.5\n)\n\n# Eliminacion de elementos incluidos por defecto\nroll_corr.set_titles('')\nroll_corr.set_xlabels('')\nroll_corr._legend.remove()\n\n# Iteracion sobre facets para etiquetar los ejes Y\nfor ax, title in zip(roll_corr.axes.flat, roll_corr.row_names):\n    ax.set_ylabel(title)\n\n# Formateo de fechas en el eje X\n    date_format = mdates.DateFormatter('%b %Y')\n    ax.xaxis.set_major_formatter(date_format)\n\n# Trazado de lineas de referencia\nfor ax in roll_corr.axes.flat:\n\n    # Trazado de linea 0\n    ax.axhline(0, color='black', linestyle='-', linewidth=1, alpha=0.5)\n\n    # Trazado de limites de confianza\n    ax.axhline(conf_rolling_corr, color='gray', linestyle='--', linewidth=0.8, alpha=0.5)\n    ax.axhline(-conf_rolling_corr, color='gray', linestyle='--', linewidth=0.8, alpha=0.5)\n    ax.axhspan(-conf_rolling_corr, conf_rolling_corr, color='gray', alpha=0.1)\n\n    # Anotacion del limite de confianza\n    ax.text(\n        x=0.82,\n        y=0.8,\n        s='Intervalo de confianza al 95%',\n        transform=ax.transAxes,\n        fontsize=8,\n        color='gray'\n    )    \n\n# Creacion de nueva leyenda\nroll_corr.figure.legend(\n    loc='lower center',\n    bbox_to_anchor=(0.5, -0.03),\n    ncol=3,\n    title=\"Profundidad de los sensores de suelo\",\n    frameon=False\n)\n\n# Establecimiento de titulo\n# roll_corr.figure.suptitle(f'Correlación entre nivel freático y variables del suelo en ventanas móviles de {window_days} días', \n#                            x=0.5, y=0.98, fontsize=14)\n\n# Ajustes de espaciado\nplt.tight_layout()\nplt.subplots_adjust(top=0.93, bottom=0.11) # Ajusta espacio disponible para facets\n\nplt.show()\n\n\n\n\n\nFigura 5. Evolución temporal de las correlaciones entre profundidad del nivel freático y variables del suelo en ventanas móviles de dos meses.\n\n\n\n\n\n\nDiagrama de Hövmoller\nFinalmente, se construyó un diagrama de Hövmoller para representar la evolución temporal de las variables de suelo en un perfil vertical, al cual se superpuso la profundidad de las aguas subterráneas (Figura 6). El perfil se obtuvo interpolando cada un centímetro los datos entre los sensores de suelo, para cada día disponible.\nEn el diagrama superior se ve cómo la profundidad de las aguas subterráneas tiene un efecto sobre la distribución vertical del agua en el suelo. Por el contrario, el diagrama de temperaturas no muestra una relación aparente con el nivel freático, sin embargo, permite visualizar que la temperatura en el perfil de suelo está condicionada a lo que ocurre en superficie. Durante el invierno es el enfriamiento superior el que se transmite hacia capas profundas, mientras que en verano la existencia de pulsos de calor contribuyen a aumentar la temperatura en profundidad. La distribución temporal de los pulsos sugiere que se trata de eventos de precipitación.\n\n\nCode\n# Definicion de funcion para generar un mapa de calor\ndef heatmap(data, **kwargs):\n    \n    # Pivoteo de los datos largos a matriz. La funcion de mapeo de heatmap\n    # de matplotlib (pcolormesh) requiere datos en formato ancho\n    pivot_data = data.pivot(index='Depth_m', columns='Date', values='Value')\n\n    # Defincion de objetos que guardan los elementos de la matriz\n    X = pivot_data.columns  # Fechas\n    Y = pivot_data.index    # Profundidades\n    Z = pivot_data.values   # Valores\n\n    # Asignacion condicional de colores y etiquetas segun variable\n    variable = data['Variable-label'].iloc[0]\n    if 'Temperatura (°C)' in variable:\n        palette = 'OrRd'\n        label = 'Temperatura (°C)'\n    else:\n        palette = 'PuBu'\n        label = 'Contenido de agua (m³/m³)'\n\n    # Renderizado de la grilla interpolada usando pcolormesh\n    mesh = plt.pcolormesh(X, Y, Z, cmap=palette, shading='auto')\n\n    # Definicion del objeto ax\n    ax = plt.gca()\n\n    # Trazado de nivel freatico en los axes\n    gw_df = kwargs.get('groundwater_data')\n    col_piezo = 'Piezometer_NA_groundwater-depth_m' \n    ax.plot(\n        gw_df.index, \n        gw_df[col_piezo], \n        color='black',\n       linestyle='-',\n        linewidth=1.5,\n        label='Nivel freático'\n        )\n\n    # Creacion de leyenda\n    cbar = plt.colorbar(mesh, \n                 ax=ax, \n                 label=label, \n                 pad=0.02, \n                 aspect=10,\n                 shrink=0.7)\n    cbar.set_label(\n        label, \n        rotation=-90,\n        labelpad=15\n        )\n\nhovmoller = sns.FacetGrid(\n    data=hovmoller_df,\n    row='Variable-label',\n    height=4,\n    aspect=2.2,\n    sharex=True,\n    sharey=True\n)\n\n# Mapeo del heatmap\nhovmoller.map_dataframe(heatmap, groundwater_data=wide_df)\n\n# Eliminacion de elementos incluidos por defecto\nhovmoller.set_titles('')\n\n# Iteracion sobre facets\nfor i, ax in enumerate(hovmoller.axes.flat):\n    \n    # Añadido de leyenda del nivel freatico \n    if i == 1:\n        ax.legend(loc='upper right', frameon=False, fontsize='small', framealpha=0.8)\n    \n    # Formateo de fecha\n    date_fmt = mdates.DateFormatter('%b %Y')\n    ax.xaxis.set_major_formatter(date_fmt)\n\n    # Añadido de profundidad de sensores\n    for d in [0.15, 0.30, 0.48]:\n        ax.axhline(d, color='gray', linestyle='--', alpha=0.3, linewidth=1)\n        ax.text(wide_df.index[0], d, f' {d*100:.0f} cm', color='gray', va='bottom', fontsize=8, alpha=0.7)\n\n# Inversion del eje Y\ny_min, y_max = 0, 0.7\nhovmoller.set(ylim=(y_max, y_min))\n\n# Etiquetado del eje Y\nhovmoller.figure.supylabel(\n    'Profundidad del perfil (m)',\n    x=0.04,\n    size=plt.rcParams['axes.labelsize'], # Igualar tamaño al eje X\n    )\n\n# Establecimiento del titulo\n# hovmoller.figure.suptitle(\"Variables de suelo interpoladas en un perfil vertical\",\n#                             x=0.5, y=0.98, fontsize=14)\n\n# Ajustes de espaciado\nplt.tight_layout()\nplt.subplots_adjust(top=0.94, bottom=0.11, left=0.1) # Ajusta espacio disponible para facets\n\nplt.show()\n\n\n\n\n\nFigura 6. Dinámica temporal de las variables de suelo en el perfil con datos interpolados verticalmente."
  },
  {
    "objectID": "index.html#desafíos",
    "href": "index.html#desafíos",
    "title": "Exploración de las relaciones entre aguas subterráneas y variables del suelo",
    "section": "Desafíos",
    "text": "Desafíos\nDesarrollar una conclusión a partir de los resultados iniciales y cuáles serían próximos pasos a desarrollar para continuar con la investigación."
  }
]